<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>reveal.js</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/dracula.css"> 
		<!--  <link rel="stylesheet" href="dist/theme/serif.css"> -->

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">
		<style>
			#slide-logo {
				position: fixed;
				top: 12px;
				left: 12px;
				height: 48px;      /* Adjust as needed */
				width: auto;
				z-index: 1000;     /* Ensure it's above other content */
				pointer-events: none; /* So it doesn't block slide navigation */
				}
		</style>
	</head>
	<body>
		<img id="slide-logo" src="../presentation/valkyr-logo.png" alt="Logo" />
		<div class="reveal">
			<div class="slides">
				<section data-markdown>
					<textarea data-template>
						#### Prediktív elemzés ciklikus adatokon Splunk MLTK segítségével

						Filep Illés - Valkyr  
						ifilep@valkyr.hu
					</textarea>
				</section>
				<section>
					<h1>A probléma</h1>
					<img src="../presentation/103_03_cylic.png" width="100%">
					<img src="../presentation/01_slide.svg">

					<aside class="notes">
						<ul>
							<li></li>
						</ul>
					</aside>
				</section>
				<section>
					<h2>Előfeltélek</h2>
					<h3>Folytonosság</h3>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<pre><code data-trim data-noescape style="font-size: 0.6em;">
`hass_entry("sensor","temperature","0x00124b0029204309")`
`hass_select_data`
| bin span=1m _time
| where value!="unavailable"
| stats count by _time, value
| makecontinuous _time span=1m
							</code>
							<table>
								<tr>
									<td>_time</td>
									<td>value</td>
									<td>count</td>
								</tr>
								<tr>
									<td>2025-05-12 19:58</td>
									<td>0</td>
									<td>1</td>
								</tr>
								<tr>
									<td>2025-05-12 19:59</td>
									<td>14.13</td>
									<td>1</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>14.01</td>
									<td>1</td>
								</tr>
								<tr>
									<td>2025-05-12 20:01</td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>2025-05-12 20:02</td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>2025-05-12 20:03</td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>2025-05-12 20:04</td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>2025-05-12 20:05</td>
									<td></td>
									<td></td>
								</tr>
								<tr>
									<td>2025-05-12 20:06</td>
									<td>13.89</td>
									<td>1</td>
								</tr>
								<tr>
									<td>2025-05-12 20:07</td>
									<td></td>
									<td></td>
								</tr>
							</table>
						</div>
						<div style="flex: 1; padding-left: 15px; box-sizing: border-box;">
							<img src="../presentation/02_slide.svg">
						</div>
						<aside class="notes">
							<ul>
								<li>A nullokon nem tudunk műveleteket végezni</li>
								<li>Valahogyan kezelni kell</li>
							</ul>
						</aside>
					</div>
				</section>
				<section>
					<h2>Lehetséges megoldások</h2>

					<img src="../presentation/03_slide.svg">
					<aside class="notes">
						<ul>
							<li>Alapvető és gyorsításos módszerekkel a gond, hogy minden adatot mindig felkell olvasni</li>
							<li>streaming jó megoldás, nagyon, de bonyolult és kicsi a flexibilitás, lásd Dataflow model és Apache Beam/Flink</li>
							<ul>
								<li>Splunkban summary indexekkel tudunk ilyeneket</li>
							</ul>
							<li>Mi az MLTK-ról fogunk beszélni</li>
							<li>A legésszerűbb megoldás több ötlet kombinációja lenne</li>
						</ul>
					</aside>
				</section>
				<section>
					<h4>A fájl</h4>
					<img src="../presentation/04_slide.svg" height="600vh" width="100%">
					<aside class="notes">
						<ul>
							<li>remélem ijesztő</li>
							<li>akkor bontsuk részekre inkább</li>
							<li>Ez a DensityFunction.py fájl az MLTK-ban</li>
						</ul>
					</aside>
				</section>
				<section>
					<h3>Támogatott eloszlások</h3>
					<p>Elsőnek elemezzük ki ezt a részt:</p>
					<img src="../presentation/05_slide.svg">
					<p>Most csak a normális eloszlással foglalkozunk.</p>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<pre><code data-trim data-noescape>
codecs_manager.add_codec(
	'algos_support.density_function.normal_distribution',
	'NormalDistribution',
	SimpleObjectCodec,
)
							</code></pre>
						</div>
					<aside class="notes">
						<ul>
							<li>Van 1 csomó eloszlás</li>
							<li>Mi tudjuk, hogy normálisat fogunk használni</li>
							<li>Thresholdokról később fogok beszélni</li>
							<li>ez egy algos_support/density_function/normal_distribution.py-re mutat</li>
							<li>Abban a fájlban csak egy wrapper script van a scipy.stats.norm-hoz</li>
						</ul>
					</aside>
				</section>
				<section>
					<h2>fit ág</h2>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<img src="../presentation/06_slide.svg">
						</div>
					</div>
					<pre><code data-trim data-noescape style="font-size: 0.7em;">
def _fit_data(self, distribution, data, mlspl_limits):
	"""Fit an instance of ProbabilityDistribution over data.
	Warn if there are too few data points in the data array"""
	min_data_size = int(mlspl_limits.get('min_data_size_to_fit', 50))
	if len(data) < min_data_size and not self._warned_on_few_training_data:
		self._warned_on_few_training_data = True
		self._warn_on_few_training_data()
	# To fix the error of object not having "_exclude_dist" attribute, when partial_fit is used on a smaller dataset and with an earlier version of MLTK (<=5.3.0)
	self._exclude_dist = self._exclude_dist if hasattr(self, '_exclude_dist') else None
	distribution.fit(data.values, self._metric, self._exclude_dist)
	self._warn_on_dist_name_mismatches_threshold(distribution.get_name(), self._threshold)
	self._distance = distribution.distance
					</code></pre>
					<aside class="notes">
						<ul>
							<li>látszódik, hogy > 50 adatpont kell</li>
							<li>ez nekünk 80m-es csoportosítást fog jelenteni</li>
							<li>a fit állítja elő a modellt, amit lefogunk menteni</li>
						</ul>
					</aside>
				</section>
				<section>
					<h2>FIT ág következtetései</h2>
					<img src="../presentation/07_slide.svg">
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<pre><code style="font-size: 0.7em;">
`hass_entry("sensor","temperature","0x00124b0029204309")`
`hass_select_data`
`hass_fill_missing(80m)`
| eval minutebin=strftime(_time,"%M")
| eval hourbin=strftime(_time,"%H") 
| eval bin=printf(hourbin."-".minutebin)
| stats count by bin
							</code></pre>
							<table style="font-size: 0.5em;">
								<tr>
									<td>bin</td>
									<td>count</td>
								</tr>
								<tr>
									<td>00-00</td>
									<td>79</td>
								</tr>
								<tr>
									<td>01-20</td>
									<td>82</td>
								</tr>
								<tr>
									<td>02-40</td>
									<td>101</td>
								</tr>
								<tr>
									<td>04-00</td>
									<td>105</td>
								</tr>
								<tr>
									<td>05-20</td>
									<td>109</td>
								</tr>
					
							</table>
						</div>
						<div style="flex: 1;">
							<pre><code style="font-size: 0.7em;">
`hass_entry("sensor","temperature","0x00124b0029197748")`
`hass_select_data`
`hass_fill_missing(80m)`
| eval minutebin=strftime(_time,"%M")
| eval hourbin=strftime(_time,"%H") 
| fit DensityFunction value by "hourbin,minutebin"
dist=norm threshold=0.005
							</code></pre>
							<table style="font-size: 0.4em;">
								<tr>
									<td>_time</td>
									<td>value</td>
									<td>minutebin</td>
									<td>hourbin</td>
									<td>IsOutlier(value)</td>
									<td>BoundaryRanges</td>
								</tr>
								<tr>
									<td>2025-05-12 18:40</td>
									<td>0.0</td>
									<td>40</td>
									<td>18</td>
									<td>1.0</td>
									<td>-Infinity:16.683:0.0025<br>32.14:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 18:40</td>
									<td>23.09</td>
									<td>40</td>
									<td>18</td>
									<td>0.0</td>
									<td>-Infinity:16.683:0.0025<br>32.14:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>22.91</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>22.94</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>23.0</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>23.03</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>23.06</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>23.08</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>23.09</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
								<tr>
									<td>2025-05-12 20:00</td>
									<td>23.1</td>
									<td>0</td>
									<td>20</td>
									<td>0.0</td>
									<td>-Infinity:19.5733:0.0025<br>29.5814:Infinity:0.0025</td>
								</tr>
							</table>						</div>
					</div>
					<aside class="notes">
						<ul>
							<li>látszódik, hogy > 50 adatpont kell</li>
							<li>ez nekünk 80m-es csoportosítást fog jelenteni</li>
							<li>14 napra nézünk vissza</li>
							<li>a fit állítja elő a modellt, amit lefogunk menteni</li>
							<li>A szintaktikája még SPL-hez képest is bizar</li>
						</ul>
					</aside>					
				</section>
				<section>
					<h1>Konfiguráció</h1>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<img src="../notes/204_01_mltksettings.png" style="width: 100%;">
						</div>
						<div style="flex: 1;">
							<p>mlspl.conf</p>
							<pre><code data-trim data-noescape style="font-size: 0.9em;">
[default]
handle_new_cat = &lt;string&gt;
max_distinct_cat_values = &lt;int&gt;
...
[DensityFunction]
default_prob_threshold = &lt;float&gt;
max_fields_in_by_clause = &lt;int&gt;
max_groups = &lt;int&gt;
* defaults to 1024
...
[score:pairwise]
max_fields = &lt;int&gt;
* default to 50
							</code></pre>
						</div>
					</div>
				</section>
				<section>
					<h4>| apply</h4>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<pre class="mermaid">
								graph TB
									A[DensityFunction Class]
									
									A --> F[Main Methods]
									F --> F3[apply]
									
									
									F3 --> H[Output Generation]
									H --> H1[IsOutlier]
									H --> H2[BoundaryRanges]
									H --> H3[ProbabilityDensity]
									H --> H4[SampledValue]
							</pre>
						</div>
						<div style="flex: 1;">
							<img src="../notes/205_01_apply.png">
						</div>
					</div>
				</section>
				<section>
					<h3>| apply</h3>
					<img src="../notes/205_02_apply.png">
					<img src="../notes/205_03_normalpdf.png">
				</section>
				<section>
					<h3>Vizualizáció</h3>
					<img src="../notes/206_01_viz.png">
				</section>
				<section>
					<h3>Predikció</h3>
					<img src="../notes/206_02_pred.png">
					<img src="../notes/206_03_pred_dashboard.png">
				</section>
				<section>
					<h3>Threshold paraméter</h3>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">
							<p>$\alpha=0.05$</p>
							<img src="../notes/207_01_thershold_005.png">
						</div>
						<div style="flex: 1;">
							<p>$\alpha=0.1$</p>
							<img src="../notes/207_02_thershold_01.png">
						</div>
					</div>
				</section>
				<section>
					<h4>Használat</h4>
					<pre class="mermaid">
					graph TB
						hasss_build_model_furdo[["`hasss_build_model_furdo
												20 1 * * *`"]];
						hasss_build_model_halo[["`hasss_build_model_halo
												40 2 2,4.. * *`"]];
						hasss_build_model_konyha[["`hasss_build_model_konyha
													0 4 3,6... * *`"]];
						hasss_build_model_dolgozo[["`hasss_build_model_dolgozo
													20 5 4,8... * *`"]];
						hass_build_model{{"`hass_build_model`"}};
						hass_entry>"`hass_entry`"];
						hass_select_data>"`hass_select_data`"];
						hass_fill_missing>"`hass_fill_missing`"];
						hass_model_builder>"`hass_model_builder`"];

						hass_build_model --> hasss_build_model_furdo;
						hass_build_model ---> hasss_build_model_halo;
						hass_build_model ----> hasss_build_model_konyha;
						hass_build_model -----> hasss_build_model_dolgozo;
						hass_entry --> hass_build_model;
						hass_select_data --> hass_build_model;
						hass_fill_missing --> hass_build_model;
						hass_model_builder --> hass_build_model;						
					</pre>
				</section>
				<section>
					<h3>Model építés példák</h3>
							<pre><code  data-trim data-noescape style="font-size: 0.9em;">
[hass_build_model]
search = `hass_entry("$domain$","$class$","$entity$")`\
`hass_select_data`\
`hass_fill_missing($span$m)`\
`hass_model_builder("$domain$","$class$","$entity$",$threshold$)`
							</code></pre>
							<pre><code  data-trim data-noescape style="font-size: 0.9em;">
[hasss_build_model_dolgozo]
cron_schedule = 20 5 */4 * *
search = | savedsearch hass_build_model domain=sensor \
class=temperature entity=0x00124b0029197748 threshold=0.005 span=80
enableSched = 1
schedule_window = auto
							</code></pre>
				</section>
				<section>
					<h4>Riasztás</h4>
					<div style="display: flex; align-items: flex-start; width: 100%;">
						<div style="flex: 1;">

							<pre class="mermaid">
								graph TB
									decision_1{"`Milyen
												sűrű a 
												modellünk?`"}
									hystering["Hiszterizálás"];
									threshold["Magas threshold"];

									decision_1 --"Eléggé<br>(legalább félóránként)"--> hystering;
									decision_1 --"Több, mint félóránként van<br>1 adatpont"--> threshold;
							</pre>
						</div>
						<div style="flex: 1;">
							<img src="../notes/208_01_correct_alert_threshold.png">
						</div>
					</div>
				</section>
				<section>
					<h3>Riasztás gráf</h3>
					<pre class="mermaid">
						graph TB
							HASS_Erkely_Outler[["`HASS Erkely Outler
												10,30,50 * * * *
												-90m@m -10m@m
												cnt=0`"]];
							HASS_Konyha_Outler[["`HASS Konyha Outler
												10,30,50 * * * *
												-90m@m -10m@m
												cnt=0`"]];
							HASS_furdo_Outler[["`HASS furdo Outler
												10,30,50 * * * *
												-90m@m -10m@m
												cnt=0`"]];
							HASS_halo_Outler[["`HASS halo Outler
												10,30,50 * * * *
												-90m@m -10m@m
												cnt=0`"]];
							HASS_Dolgozo_Outler[["`ASS Dolgozo Outler
												10,30,50 * * * *
												-90m@m -10m@m
												cnt=0`"]];
							hass_apply_modell{{"`hass_apply_modell`"}};
							hass_entry>"`hass_entry`"];
							hass_select_data>"`hass_select_data`"];
							hass_fill_missing>"`hass_fill_missing`"];
							hass_model_apply_extend_pred>"`hass_model_apply_extend_pred`"];
							hass_model_apply>"`hass_model_apply`"];
							hass_clean_pred>"`hass_clean_pred`"]

							hass_entry --> hass_apply_modell;
							hass_select_data --> hass_apply_modell;
							hass_fill_missing --> hass_apply_modell;
							hass_model_apply_extend_pred --> hass_apply_modell;
							hass_model_apply --> hass_apply_modell;
							hass_clean_pred --> hass_apply_modell;
							hass_apply_modell --> HASS_Erkely_Outler;
							hass_apply_modell ---> HASS_Konyha_Outler;
							hass_apply_modell ----> HASS_furdo_Outler;
							hass_apply_modell -----> HASS_halo_Outler;
							hass_apply_modell ------> HASS_Dolgozo_Outler;
					</pre>
				</section>
				<section>
					<h3>Mire lehet még használni?</h3>
					<pre class="mermaid">
						flowchart LR
							log_count["logok darabszáma"];
							firewall>"tűzfal"];
							EDR>"EDR"];
							email>"email"];
							db_query>"Adatbázis kérések"];
							rest>"Rest Api kérések"];
							event_lenght["Események hossza"];
							session>"sessionok"];
							CPU_usage>"CPU használat"];
							ticket>"hiba bejelentések"];

							firewall --> log_count;
							EDR --> log_count;
							email --> log_count;
							db_query --> log_count;
							rest --> log_count;
							session --> log_count;
							ticket --> log_count;

							db_query --> event_lenght;
							CPU_usage --> event_lenght;
							session --> event_lenght;
					</pre>
				</section>
				<section>
					<h4>MLTK felhasználásai</h4>
					<pre class="mermaid">
						mindmap
							root((MLTK))
								Adat előkészítés
								Adatelemzés
								Kluszterizálás
								Előrejelzés
								Pontbecslés
								Outlier detektálás
					</pre>
				</section>
				<section>
					<h3>MLTK felhasználásai</h3>
					<h4>Adat előkészítés</h4>
					<pre class="mermaid">
						mindmap
							root(Adat előkészítés)
								Preprocesing
									Imputer
									Robust Scaler
									Standard Scaler
								Feature Extraction
									lineáris
									PCA
									HashingVectorizer
									ICA
									nem-lineáris
									KernelPCA
									TFIDF
									NPR
					</pre>
				</section>
				<section>
					<h3>MLTK felhasználásai</h3>
					<h4>Adat elemzés és előrejelzés</h4>
					<pre class="mermaid">
						mindmap
						root(Idősor elemzés)
							Adatelemzés
								Autocorrelation function
								Partial autocorrelation Function
							Előrejelzés
								ARIMA
								KalmanFilter
								StateSpaceForecast
					</pre>
				</section>
				<section>
					<h3>MLTK felhasználásai</h3>
					<h4>Minta elemzés</h4>
					<pre class="mermaid">
						mindmap
							root(Minta elemzés)
								Kluszterizálás
									Partíció alapú - XMeans
									Távolság alapú -KMeans		
									Gráf alapú - SpectralClustering
									Hiearhia alapú - Birch
									Sűrűség alapú - DBSCAN
								Outlier detektálás
								DensityFunction
								LocalOutlierFactor
								OneClassSVM
					</pre>

				</section>
				<section>
					<h3>MLTK felhasználásai</h3>
					<h4>Regressziók - Számokra</h4>
					<pre class="mermaid">
						mindmap
							root(Szám-regresszió)
								Lineáris
									LinearRegression
									Ridge
									Lasso
									ElasticNet
									SDGRegressor
								Nem-lineárs
									Fa alapú
										DecisionTree
										GradientBoosting
										RandomForest
									Kernel alapú
										KernelRidge
					</pre>
				</section>
				<section>
					<h3>MLTK felhasználásai</h3>
					<h4>Címkéző algoritmusok</h4>
					<pre class="mermaid">
						mindmap
							root(Osztály-klasszifikáló)
								Lineáris
									LogisticRegression
									SGD
									SVM
								Naive bayes
									BernoulliNB
									GaussianNB
								Fa alapú
									DecisionTree
									GradientBoosting
									RandomForest
								Neurális háló - MLP
					</pre>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script type="module">
			import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
			mermaid.initialize({	
									securityLevel: 'loose',
									theme: 'base',
									themeVariables: {
											nodeBorder: '#BB2528',
											nodeTextColor: '#F8F8F2',
											mainBkg: '#373c57',
											lineColor: '#FF79C6',
											edgeLabelBackground: '#44475A',
											tertiaryColor: '#ffff',
											secondaryColor: '#ffff',
											primaryColor: '#ffff'
										}
			 });
		</script>
		<script src="plugin/math/math.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				width: 960,
  				height: 700,
				slideNumber: true,
				preloadIframes: true,
				margin: 0.04,
				minScale: 0.2,
 				maxScale: 1.0,
				center: true,
				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ]
			});
		</script>
	</body>
</html>
